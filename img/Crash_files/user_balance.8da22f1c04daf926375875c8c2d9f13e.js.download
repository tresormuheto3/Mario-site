var user_balance={state:{accounts:[],bonuses:[],promo:0,main:0,lastRequestTime:0},getMainBalance:function getMainBalance(){var a=0,b=this;b.state.accounts.some(function(b){if(b.is_active){a=b.money;return true}return false});return a},getBalance:function getBalance(a){balance.methods.getBalance(a)},getAllIdCurrencies:function getAllIdCurrencies(){return this.state.accounts.filter(function(a){return[9,0,6].indexOf(a.type)!==-1}).map(function(a){return a.id_currency})},getAllCurrencyAccounts:function getAllCurrencyAccounts(){return this.state.accounts.filter(function(a){return[9,6].indexOf(a.type)!==-1})},getPrimaryUserId:function getPrimaryUserId(){var a=0;this.state.accounts.some(function(b){if(!b.type){a=b.id;return true}});return a},getSelectAccount:function getSelectAccount(){var a=[];this.state.accounts.some(function(b){if(b.is_active){a=b;return true}});return a},is_bonus:function is_bonus(a){a=a||0;var b=false;this.state.accounts.some(function(c){if(c.id==a){b=[9,0,6].indexOf(c.type)==-1}});return b},getMainBalanceCurrency:function getMainBalanceCurrency(){var a=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.code:"",b=this;b.state.accounts.some(function(b){if(b.is_active){a=b.iso;return true}return false});return a},getPrimaryCurrencyId:function getPrimaryCurrencyId(){var a=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.id:1;this.state.accounts.some(function(b){if(!b.type){a=b.id_currency;return true}return false});return a},getPrimaryCurrency:function getPrimaryCurrency(){var a=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.code:"",b=this;b.state.accounts.some(function(b){if(!b.type){a=b.iso;return true}return false});return a},getMainUserId:function getMainUserId(){var a=0,b=this;if(b.state.accounts){b.state.accounts.some(function(b){if(b.is_active){a=b.id;return true}return false})}return a},getCurrency:function getCurrency(a,b){var c=b||"";this.state.accounts.some(function(b){if(b.id==a){c=b.iso;return true}});return c},updateBalance:function updateBalance(a,b){this.state.accounts=this.state.accounts.map(function(c){c.money=a==c.id?b:c.money;return c})},setPoints:function setPoints(a){a=a||0;this.state.promo=a},getUserRefId:function getUserRefId(){var a=this.state.accounts.find(function(a){return a.is_active});if(!a){return 0}return a.ref_id},getBonusAccount:function getBonusAccount(){return this.state.accounts.find(function(a){return a.type===4})},balanceUpdate:function balanceUpdate(a,b){a=a||0;b=b||0;if(a){user_balance.updateBalance(a,b);window.dispatchEvent(new Event("balance.update_done"));return}user_balance.getBalance();$("#coupon_balance").html(user_balance.getMainBalance())}};var balance={template:"#user_balance",props:["firstrender"],constants:{timeForWait:5000},data:function data(){return user_balance.state},methods:{getBalanceWithThrottle:function getBalanceWithThrottle(){var a=this.$analytics,b=a.headerV2,c=a.$constants;b.clickOnButton(c.HEADER_BUTTONS.BUTTON_REFRESH_FUNDS);if(Date.now()-this.lastRequestTime<this.$consts.timeForWait){return}this.getBalance();this.lastRequestTime=Date.now()},getBalance:function getBalance(a){var b=this;b.getRequest().then(function(c){b.setDecoration(c);if(typeof a=="function"){a()}}).catch(function(a){console.log("error in balance",a)})},setDecoration:function setDecoration(a){a=a||[];var b=this,c=a.balance.map(function(a){if(a.id==b.main){b.promo=a.PointsBalance}var c={id:a.id,type:a.typ,money:a.money,name:a.AccountName,iso:a.kode,is_active:a.active,id_currency:a.idCurrecy,summ_unplaced_bets:a.summ_unplaced_bets,ref_id:a.refID};if(getRefId()===157){c.sum_in_try=a.sum_in_try}return c});user_balance.state.accounts=c;this.setBalanceToStore(typeof window.store_global==="undefined"||typeof window.store_global.state.global==="undefined",a);if(typeof Games!=="undefined"&&Games.customBalance.need_show){Games.customBalance.setBalance()}window.dispatchEvent(new Event("balance.update_done"))},getRequest:function getRequest(){return new(typeof ES6Promise!=="undefined"?ES6Promise:window.parent.ES6Promise)(function(a,b){$.post("/user/balance",function(b){if(b.success){a(b)}})})},setBalanceToStore:function setBalanceToStore(a,b){var c=null;c=setInterval(function(){if(typeof window.store_global!=="undefined"&&typeof window.store_global.state.global!=="undefined"){window.store_global.commit("set_user_id");window.store_global.commit("global/"+"globalSetUserId",user_balance.getMainUserId());window.store_global.commit("global/"+"globalSetUserRefId",user_balance.getUserRefId());if(typeof window.store_global.state.account!=="undefined"&&typeof b.balance!=="undefined"&&typeof b.bonus!=="undefined"&&typeof b.all_accounts!=="undefined"){window.store_global.commit("account/"+"accountParseAndSetData",b)}clearInterval(c)}},a?300:1)},setBalance:function setBalance(a){var b="",c=this;if(this.accounts.some(function(b){return b.id==a&&b.is_active})){return}if(typeof SUPPORT_MULTI_ACCOUNTS!="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE){alerts(dictionary.attention,dictionary.not_balance_section,2);return}this.accounts=this.accounts.map(function(c){c.is_active=c.id==a;if(c.is_active){b=c.iso}return c});Core.cookie.set("activeid",a);$.post("/user/setactiveaccount",{id:a},function(a){if(!a.success){alerts("",a.message,0);c.accounts=c.accounts.map(function(b){b.is_active=b.id==a.id;return b});Core.cookie.set("activeid",a.id);return}$(".coupon_currency").html(b);$("#coupon_balance").html(user_balance.getMainBalance());$(window).trigger("balance.change");window.dispatchEvent(new Event("balance.change"));document.dispatchEvent(new CustomEvent("sumbets.change"));if(window.Popup.isOpen("fastDeposit")){$.arcticmodal("close");window.Popup.init("fastDeposit")}c.setDecoration(a);typeof store_sale!="undefined"&&store_sale.commit("initInfo")})},setBonuses:function setBonuses(a){this.bonuses=a.map(function(a){return{name:a.Trslt_BonusName||a.BonusName,start:a.bonus_start,end:a.bonus_finish,cur:a.bonus_fact,progress:parseFloat(a.bonus_fact*100/(a.bonus_finish-a.bonus_start))+"%"}})}},computed:{_currency:function _currency(){return this.accounts.filter(function(a){return[9,0,6].indexOf(a.type)!==-1})},_active:function _active(){var a={};this.accounts.some(function(b){if(b.is_active){a=b}return b.is_active});return a},_other:function _other(){return this.accounts.filter(function(a){return[9,0,6].indexOf(a.type)==-1})},_bonuses:function _bonuses(){var a=this;return this.bonuses.map(function(b,c){Vue.set(a.bonuses[c],"width",b.width=100*b.cur/b.end);return b})},_bonus_count:function _bonus_count(){return this.bonuses.length},$_visible_balance:function $_visible_balance(){return typeof this._currency[0]!=="undefined"?this._currency[0]:{}}},beforeMount:function beforeMount(){var a=Core.cookie.get("ua",0),b=this;if(a){this.main=a;this.setDecoration({balance:this.firstrender.balance});this.setBonuses(this.firstrender.bonus);document.dispatchEvent(new CustomEvent("sumbets.change"));typeof store_sale!="undefined"&&!store_sale.getters.show&&store_sale.commit("initInfo")}else{console.log("not auth")}},mounted:function mounted(){var a=this.accounts.filter(function(a){return[7,9,6,13].indexOf(a.type)==-1});$("#couponAcc").select2("destroy").html(a.map(function(a){return"<option value=\""+(!a.type?0:a.id)+"\" data-cur=\""+a.iso+"\">"+a.name+"</option>"}).join("")).select2({minimumResultsForSearch:150,dropdownCssClass:"selectCupon selectAcc"});if(a.length>1){$(".coupon-account").show()}this.accounts.some(function(a){if(a.is_active){$(".coupon_currency").html(a.iso);$("#coupon_balance").html(user_balance.getMainBalance());return true}});var b=this;if(!!window.IFRAME_REF_ID){window.addEventListener("message",function(a){if(a.data.event_name==="set_active_account"){b.setBalance(a.data.new_id)}})}window.addEventListener("onBalanceChange",function(a){if(a.detail){return b.setDecoration(a.detail)}b.getBalance()})}};if(typeof Vue!=="undefined"){Vue.component("user_balance",balance)}if(typeof HIDE_BALANCE!=="undefined"&&!HIDE_BALANCE){if(!Core.cookie.get("ua",0)){document.addEventListener("load.header",function(){Vue.component("user_balance",balance);new Vue({el:"#user-money",data:{},created:function created(){$(".user-money_before").remove();if(typeof SUPPORT_MULTI_ACCOUNTS!="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE){alerts(dictionary.attention,dictionary.not_balance_section,2)}}})})}else{$(document).on("load.user.money",function(){new Vue({el:"#user-money",data:{},created:function created(){$(".user-money_before").remove();if(typeof SUPPORT_MULTI_ACCOUNTS!="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE){alerts(dictionary.attention,dictionary.not_balance_section,2)}}})})}}$(window).on("balance.update",user_balance.balanceUpdate);$(document).on("ready",function(){if(typeof IFRAME_CHECK_BALANCE!=="undefined"||typeof HIDE_BALANCE!=="undefined"&&HIDE_BALANCE){user_balance.getBalance();$("#coupon_balance").html(user_balance.getMainBalance())}});$("#couponAcc").on("change",function(){var a=$(this).find(":selected");var b=a.val()==0?user_balance.getMainBalanceCurrency():a.attr("data-cur");$(".coupon_currency").html(b);$("#coupon_balance").html(user_balance.getMainBalance())});